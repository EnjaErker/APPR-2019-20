---
title: "Poročilo pri predmetu Analiza podatkov s programom R"
subtitle: "Analiza stanovanjskih razmer in opremljenosti stanovanj po občinah v Sloveniji"
author: "Enja Erker"
output:
  html_document: default
  pdf_document:
    includes:
      in_header: lib/styles.sty
    latex_engine: xelatex
#runtime: shiny
---

```{r setup, echo=FALSE, results='hide', message=FALSE, warning=FALSE}
# Če želimo nastaviti pisave v PDF-ju, odkomentiramo
# in sledimo navodilom v programu.
#source("fontconfig.r", encoding="UTF-8")

# Uvoz vseh potrebnih knjižnic
source("lib/libraries.r", encoding="UTF-8")
```

```{r rstudio, echo=FALSE, results='asis'}
# Izris povezave do RStudia na Binderju
source("lib/rstudio.r", encoding="UTF-8")
```

# Izbira teme

Tema: stanovanjske razmere in opremljenost stanovanj (po občinah v Sloveniji)

Osnovna ideja: 
-	analizirati osnovne indikatorje opremljenosti stanovanj po občinah (napeljave, prostori, površine, …) za leto 2015 (napeljave za zadnje razpoložljivo leto 2010),
-	analizirati druge indikatorje (razvoja) občin (neto plače, brezposelnost, gostota prebivalstva) za leto 2015,
-	poiskati povezave (korelacije) med izbranimi spremenljivkami za leto 2015,
-	ugotoviti medsebojne vplive (regresije) določenih spremenljivk (npr. vpliv brezposelnosti na opremljenost ali vpliv starosti prebivalstva na opremljenost) za leto 2015,
-	analizirati časovno serijo za napeljave  (2002-2008, letni podatki).

Plan dela: 
-	Razvrščanje podatkov (iskanje občin s podobnimi lastnostmi): po opremljenosti, po razmerah,
-	Predikcija (napovedovanje časovne vrste, trendi): napovedovanje razvoja opremljenosti stanovanj glede na razvitost občine, večja opremljenost <- večje neto plače, slabše/boljše razmere <– večja/manjša gostota naseljenosti občine.


# Obdelava, uvoz in čiščenje podatkov

```{r uvoz, echo=FALSE, message=FALSE}
source("uvoz/uvoz.r", encoding="UTF-8")
```

Oblike vhodnih podatkov:
-	Csv datoteka z različnimi ločili,
-	Excel datoteka.

Spletne strani oziroma viri podatkov:

1.	https://pxweb.stat.si/SiStatDb/pxweb/sl/20_Ekonomsko/20_Ekonomsko__19_gradbenistvo__95_arhivski_podatki__06_19071_stanov_sklad/1907104S.px/
2.	https://pxweb.stat.si/SiStatDb/pxweb/sl/10_Dem_soc/10_Dem_soc__08_zivljenjska_raven__25_STANOVANJA__02_08611-stanovanja_OBC/0861140S.px/
3.	https://www.stat.si/obcine

Podatki so v treh razpredelnicah, sprva še niso v obliki *tidy data*.

1. `napeljave` - podatki o napeljavah za vsako občino:
  - `občina` - imenska spremenljivka: ime občine (neurejen faktor, character)
  - `vodovod` - meritev: število stanovanj z vodovodom (število, integer)
  - `kanalizacija` - meritev: število stanovanj s kanalizacijo (število, integer) 
  - `električni tok` - meritev: število stanovanj z električnim tokom (število, integer)
  - `centralno ogrevanje` - meritev: število stanovanj z centralnim ogrevanjem (število, integer)
  - `kopalnica` - meritev: število stanovanj s kopalnico (število, integer)
  - `stranišče` - meritev: število stanovanj s straniščem (število, integer)
  - `kuhinja` - meritev: število stanovanj z kuhinjo (število, integer)

2. `kazalniki` - podatki o statističnih kazalniki za vsako občino:
  - `občina` - imenska spremenljivka: ime občine (neurejen faktor, character)
  - `gostota prebivalstva (preb/km2)` - meritev: gostota prebivalstva v enotah prebivalcev na kvadratni kilometer (število, numeric)
  - `povprečna mesečna neto plača (indeks)` - meritev: povprečna mesečna neto plača podana v indeksu (število, integer) 
  - `stopnja registrirane brezposelnosti (odstotek)` - meritev: stopnja registrirane brezposelnosti podana v odstotkih (število, numeric)
  - `število stanovanj (na 1000 prebivalcev)` - meritev: število stanovanj v posamezni občini, podano na 1000 prebivalcev (število, integer)

3. `pomankljivosti` - podatki o pomankljivostih stanovanj za vsako občino:
  - `občina` - imenska spremenljivka: ime občine (neurejen faktor, character)
  - `število vseh stanovanj` - meritev: število vseh stanovanj (število, integer)
  - `število stanovanj brez centralnega ogrevanja` - meritev: število stanovanj brez centralnega ogrevanja (število, integer) 
  - `število stanovanj brez vode` - meritev: število stanovanj brez vode (število, integer)
  - `število stanovanj brez elektrike` - meritev: število stanovanj brez elektrike (število, integer)
  - `število stanovanj brez priklopa na javno kanalizacijo` - meritev: število stanovanj brez priklopa na javno kanalizacijo (število, integer)

Pretvorba razpredelnic v *tidy data*

1.`napeljave`
  - poimenovanje prvega stolpca
  - izbris vrstic (občin) s pomankljivimi podatki (v konkretnem primeru NA ali z)
  - konstrukcija 'podtabel' za lažjo kasnejšo analizo (izbira le nekaterih stolpcev, sprememba character -> numeric)
  - zružitev podatkov glede na leto, število in tip podatka
  - filtriranje v posamezne podtabele (vodovod, kanalizacija, centralno ogrevanje, električni tok, stranišče, kuhinja, kopalnica)

2.`kazalniki`
  - poimenovanje stolpcev
  - izbris zadnjih dveh stolpcev, ki jih ne potrebujem
  - izbris podvojenih občin
  - združitev glede na tip podatka in število

4.`pomankljivosti`
  - poimenovanje stolpcev
  - izbris zadnjih 20 vrstic z nepomembnimi podatki
  - združitev podatkov glede na tip in vrednost


Spodnji graf prikazuje porazdelitev števila naselij v občinah.


????????????????????????????
```{r histogram, echo=FALSE, message=FALSE, fig.align='center', fig.cap='Histogram števila naselij v občinah'}
ggplot(obcine, aes(x=naselja)) + geom_histogram() +
  ggtitle("Pogostost števila naselij") + xlab("Število naselij") + ylab("Število občin")
```

***

# Analiza in vizualizacija podatkov

Prvi korak v analizi je bila analiza napeljav od leta 2002 do leta 2010. Naredila sem podtabele z uporabo ukaza filter za vodovod, centralno ogrevanje, električni tok, kopalnico, stranišče, kuhinjo in kanalizacijo. Tako sem dobila podtabele z vrednostmi, ki predstavljajo število stanovanj z določeno napeljave, npr. vodovodom. Z istim ukazom sem občine sortirala  glede na gostoto poselitve, registrirano stopnjo brezposelnosti, povprečno mesečno neto plačo in število stanovanj. Tu sem vzela podatke zadnjega razpoložljivega leta - 2015.

Za vsako od omenjenih lastnosti sem nato občine razdelila v nekaj skupin s podobnostmi. Uporabila sem ukaz mutate. Na primer občine, ki so zelo gosto poseljene so sedaj označene in združene v eno skupino. Podobno velja tudi za občine s kritično brezposelnostjo in za tiste z nizkim indeksom povprečne mesečne neto plače. Nadaljna analiza bo na ta način lažja, saj so občine s podobnimi lastnostmi že grupirane. 

Glede na vsebino obdelanih podatkov sem naredila tabele s tistimi spremenljivkami, za katere sem sumila, da bi med njimi morda lahko obstajala povezava. Združila sem gostoto prebivalstva in kanalizacijo, povprečne plače in ogrevanje, število stanovanj in kuhinj v občini, gostoto prebivalstva ter vodovod. To sem naredila z ukazoma group_by ter summarise.

Iz podatkov o pomankljivostih leta 2015 sem izračunala okviren delež stanovanj s pomankljivostmi v posamezni občini. Na osnovi dobljenih rezultatov sem ocenila kritičnost situacije občine glede na slovensko povprečje. Občine sem nato tudi sortirala v štiri skupine glede na omenjeno lastnost. 

Na osnovi predstavljene preliminarne analize sem se lotila vizualizacij. Za predstavitev občin, grupiranih po skupinah glede na neko skupno lastnost, sem izbrala tortni diagram. Naredila sem grafični prikaz gostote prebivalstva, kritičnosti brezposelnosti ter povprečne mesečne neto plače  v Sloveniji, vse za leto 2015. Dodala sem jim naslove, tabele in oznake deležev.

Preko vizualizacije gostote prebivalstva v Sloveniji leta 2015 sem ugotovila, da je več kot 90% slovenskih občin zelo redko poseljenih, kar ni presenetljivo glede na majhnost države in delež ruralnosti le-te. Izjemno majhen delež predstavljajo občine z zelo gosto ali gosto poselitvijo, sem spada Ljubljana in še nekaj drugih večjih občin. Preostali del pa je redko poseljen, najredkeje občina Solčava.

Tortni diagram kritičnosti brezposelnosti v Sloveniji leta 2015 prikazuje, kako kritična je situacija. Kritičnost sem določila glede na slovensko povprečje, ki v indeksu znaša 12,3. Slabih 60% občin ne trpi zaradi previsoke brezposelnosti. Vendar pa je podatek o preostanku, kjer je brezposelnost glede na slovensko povprečje kritična vseeno nekoliko zaskrbljujoč. Najmanj brezposelnih ima občina Žiri, najbolj kritično pa je v Rogašovcih. 

Diagram povprečne mesečne neto plače v Sloveniji glede na indeks istega leta pa kaže, da so plače relativno visoke. Delež nizkih plač, tistih v najnižjem plačnem razredu, je le dobrih 9%. Preostali del pa je približno enakomerno razdeljen na visoke in srednje plače. Najvišji indeks je bil izmerjen v Cerkljah na Gorenjskem, najnižji pa v Kostanjevici na Krki.

Na osnovi združitve podatkov iz napeljav in kazalnikov (predstavljene zgoraj), sem narisala nekaj črtnih diagramov in na ta način analizirala odvisnosti posameznih spremenljivk: vodovodne napeljave glede na gostoto poselitve, napeljave kanalizacije glede na gostoto poselitve, ogrevalne napeljave glede na plačni razred prebivalstva in število kuhinj glede na število stanovanj. Grafom sem dodala naslove in tabele.

V prvem grafu je prikazano število vodovodnih napeljav glede na gostoto poselitve med 2002 in 2010. Opazila sem, da redkejša kot je gostota poselitve počasneje narašča število vodovodnih napeljav, kar je logično. Zanemarljivo majhne so spremembe v občinah z zelo redko ter redko gostoto, situacija tam je stabilna. Naraščajoč trend pa je opazen pri občinah z gosto in zelo gosto poselitvijo. Bolj strmo je naraščanje v občinah z zelo gosto poselitvijo.

Graf, ki prikazuje število napeljav kanalizacije glede na gostoto poselitve med 2002 in 2010 je vizualno zelo podoben prejšnjemu. Očitno enake zakonitosti kot za vodovod veljajo tudi za kanalizacijo in druge podobne napeljave. Redkejša kot je poseljenost, počasneje narašča število napeljav kanalizacije. V zelo redkih in redko poseljenih občinah teh sprememb skoraj ni opaziti.

Tretji graf prikazuje število ogrevalnih napeljav glede na plačni razred prebivalstva med 2002 in 2010. Najmanj strma je krivulja najnižjega plačnega razreda, ljudje z nizkimi plačami se torej redkeje odločajo za ogrevalne napeljave, saj si to težje privoščijo. Zelo podobno velja tudi za srednji razred, le da so številke nekoliko večje. Vendar pa število ogrevalnih napeljav vseeno raste počasi. Drugače je v najvišjem plačnem razredu, kjer število strmo narašča. Manjši padec je opaziti le v letu 2007 pred recesijo. 

Zadnji graf prikazuje število kuhinj glede na število stanovanj med 2002 in 2010. Zanimivo je, da sta krivulji za občine z majhnim in srednjim številom stanovanj skoraj identični, edina razlika je ta, da se nahajata na različnih višinah. Opazno je konstantno naraščanje z izjemo leta 2007 pred krizo. Tega momenta v krivulji za veliko število stanovanj ni moč opaziti. Pomembna je tudi ugotovitev, da je kuhinj več v občinah z srednjim številom stanovanj in manj v tistih z velikim številom. V večjih mestih namreč več ljudi živi v stanovanju brez kuhinje oziroma si jo pogosto deli s sostanovalci.

Grafično sem prikazala tudi pomanjkljivosti opremljenosti stanovanj v Sloveniji, uporabila sem tortni diagram, ki sem mu dodala še naslov, legendo in oznake za posamezne deleže. Opazila sem, da ima skoraj 40% občin zelo visoko pomanjkljivo opremljena stanovanja, pod pomanjkljiva sem obravnavala stanovanja brez vode, centralnega ogrevanja, elektrike ali javne kanalizacije. Razlog za tako visoke deleže je večinska ruralnost slovenskega območja.

Kazalnike sem grafično prikazala tudi v obliki zemljevidov, predstavljeni podatki so iz leta 2015. Narisala sem zemljevid gostote poseljenosti, iz česar se jasno vidi kontrast med Ljubljano in ostalimi občinami. Ljubljana ima namreč poselitev od 1000 do 1200 prebivalcev na kvadratni kilometer. Nekoliko nižje, vendar glede na slovensko povprečje relativno visoke, gostote imajo tudi njene sosednje občine in večja mesta na obali ter na Štajerskem.

Drugi zemljevid prikazuje povprečne mesečne neto plače glede na indeks. Ker je Slovenija v splošnem obarvana dokaj temno, so plače relativno visoke. Izstopajo le nekatere občine z indeksom pod 80 in sicer Bohinj, Bloke, Osilnica, Kostanjevica na Krki, Rečica ob Savinji, Tabor, Oplotnica, Makole, Hajdina, Moravske toplice in Gornji Petrovci. Najvišji indeks pa je v Cerkljah na Gorenjskem. 

Z zemljevidom sem prikazala tudi brezposelnost glede na indeks. Najvišja stopnja brezposelnosti je na severovzhodnem in jugovzhodnem delu države, v pretežno ruralnih občinah. Izstopajo Kočevje, Črnomelj, Trbovlje in manjše občine v Prekmurju. Najmanj brezposelnih pa je v diagonalnem pasu od severozahoda proti jugovzhodu, z izjemo občine Ljubljana. 

Zadnji zemljevid prikazuje število stanovanj na 1000 prebivalcev. Za večino občin se ta številka giblje med 300 in 400 stanovanji. Izstopa pa rob države na severni meji z Italijo. Razlog za to je najverjetneje dejstvo, da je na tem območju zelo razvit turizem. Veliko je hotelov, apartmajev in pohodniških koč. Poleg tega pa ima veliko ljudi, ki živijo v prestolnici tam vikende. 

#vzorčni primer
```{r vizualizacija, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
source("vizualizacija/vizualizacija.r", encoding="UTF-8")
```

Spodnji zemljevid prikazuje povprečno velikost družine za vsako občino.

```{r zemljevid, echo=FALSE, fig.align='center', fig.cap='Zemljevid povprečnega števila otrok v družini'}
ggplot() + geom_polygon(data=left_join(zemljevid, povprecja, by=c("OB_UIME"="obcina")),
                        aes(x=long, y=lat, group=group, fill=povprecje)) +
  ggtitle("Povprečno število otrok v družini") + xlab("") + ylab("") +
  guides(fill=guide_colorbar(title="Povprečje"))
```

***

# Napredna analiza podatkov

```{r analiza, echo=FALSE, message=FALSE}
source("analiza/analiza.r", encoding="UTF-8")
```

Spodnji graf prikazuje povezavo med številom naselij in površino občine.

```{r graf, echo=FALSE, fig.align='center', fig.cap='Povezava med številom naselij in površino občine'}
ggplot(inner_join(obcine, data.frame(obcina=names(skupine),
                                     skupina=factor(skupine)), by="obcina")
, aes(x=povrsina, y=naselja, color=skupina, size=prebivalci/1000)) + geom_point() +
  ggtitle("Število naselij glede na površino občine") +
  xlab(expression("Površina (km"^2 * ")")) + ylab("Št. naselij") +
  guides(color=guide_legend(title="Skupina"),
         size=guide_legend(title="Prebivalci (* 1000)"))
```

***

```{r shiny, echo=FALSE}
#shinyAppDir("shiny", options=list(width="100%", height=600))
```
