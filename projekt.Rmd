---
title: "Poročilo pri predmetu Analiza podatkov s programom R"
subtitle: "Analiza stanovanjskih razmer in opremljenosti stanovanj po občinah v Sloveniji"
author: "Enja Erker"
output:
  html_document: default
  pdf_document:
    includes:
      in_header: lib/styles.sty
    latex_engine: xelatex
runtime: shiny
---

```{r setup, echo=FALSE, results='hide', message=FALSE, warning=FALSE}
# Če želimo nastaviti pisave v PDF-ju, odkomentiramo
# in sledimo navodilom v programu.
#source("fontconfig.r", encoding="UTF-8")

# Uvoz vseh potrebnih knjižnic
source("lib/libraries.r", encoding="UTF-8")
```

```{r rstudio, echo=FALSE, results='asis'}
# Izris povezave do RStudia na Binderju
source("lib/rstudio.r", encoding="UTF-8")
```

# Izbira teme

Tema: stanovanjske razmere in opremljenost stanovanj (po občinah v Sloveniji)

Osnovna ideja: 
-	analizirati osnovne indikatorje opremljenosti stanovanj po občinah (napeljave, prostori, površine, …) za leto 2015 (napeljave za zadnje razpoložljivo leto 2010),
-	analizirati druge indikatorje (razvoja) občin (neto plače, brezposelnost, gostota prebivalstva, starost prebivalstva) za leto 2015,
-	poiskati povezave (korelacije) med izbranimi spremenljivkami za leto 2015,
-	ugotoviti medsebojne vplive (regresije) določenih spremenljivk (npr. vpliv brezposelnosti na opremljenost ali vpliv starosti prebivalstva na opremljenost) za leto 2015,
-	analizirati časovno serijo za napeljave  (2002-2010, letni podatki).

Plan dela: 
-	Razvrščanje podatkov (iskanje občin s podobnimi lastnostmi): po opremljenosti, po razmerah,
-	Predikcija (napovedovanje časovne vrste, trendi): napovedovanje razvoja opremljenosti stanovanj glede na razvitost občine, večja opremljenost <- večje neto plače, slabše/boljše razmere <– večja/manjša gostota naseljenosti občine.


# Obdelava, uvoz in čiščenje podatkov

```{r uvoz, echo=FALSE, message=FALSE}
source("uvoz/uvoz.r", encoding="UTF-8")
```

Oblike vhodnih podatkov:
-	Csv datoteka z različnimi ločili 
-	Excel datoteka

Spletne strani oziroma viri podatkov:

1.	https://pxweb.stat.si/SiStatDb/pxweb/sl/20_Ekonomsko/20_Ekonomsko__19_gradbenistvo__95_arhivski_podatki__06_19071_stanov_sklad/1907104S.px/
2.	https://pxweb.stat.si/SiStatDb/pxweb/sl/10_Dem_soc/10_Dem_soc__08_zivljenjska_raven__25_STANOVANJA__02_08611-stanovanja_OBC/0861140S.px/
3.	https://pxweb.stat.si/SiStatDb/pxweb/sl/10_Dem_soc/10_Dem_soc__08_zivljenjska_raven__25_STANOVANJA__02_08611-stanovanja_OBC/0861104S.px/
4.	https://www.stat.si/obcine

Podatki so v štirih razpredelnicah, sprva še niso v obliki *tidy data*.

1. `napeljave` - podatki o napeljavah za vsako občino
  - `občina` - imenska spremenljivka: ime občine (neurejen faktor, character)
  - `vodovod` - meritev: število stanovanj z vodovodom (število, integer)
  - `kanalizacija` - meritev: število stanovanj s kanalizacijo (število, integer) 
  - `električni tok` - meritev: število stanovanj z električnim tokom (število, integer)
  - `centralno ogrevanje` - meritev: število stanovanj z centralnim ogrevanjem (število, integer)
  - `kopalnica` - meritev: število stanovanj s kopalnico (število, integer)
  - `stranišče` - meritev: število stanovanj s straniščem (število, integer)
  - `kuhinja` - meritev: število stanovanj z kuhinjo (število, integer)

2. `kazalniki` - podatki o statističnih kazalniki za vsako občino
  - `občina` - imenska spremenljivka: ime občine (neurejen faktor, character)
  - `gostota prebivalstva (preb/km2)` - meritev: gostota prebivalstva v enotah prebivalcev na kvadratni kilometer (število, numeric)
  - `povprečna mesečna neto plača (indeks)` - meritev: povprečna mesečna neto plača podana v indeksu (število, integer) 
  - `stopnja registrirane brezposelnosti (odstotek)` - meritev: stopnja registrirane brezposelnosti podana v odstotkih (število, numeric)
  - `število stanovanj (na 1000 prebivalcev)` - meritev: število stanovanj v posamezni občini, podano na 1000 prebivalcev (število, integer)

#preveri izgled tabele!
3. `število oseb in sob` - podatki o številu oseb in sob v stanovanjih za vsako občino
  - `občina` - imenska spremenljivka: ime občine (neurejen faktor, character)
  - `število sob` - številska spremenljivka: število sob v stanovanju (1, 2, 3, 4, 5 ali več) (število, integer)
  - `število oseb` - številska spremenljivka: število oseb v stanovanju (1, 2, 3, 4, 5, 6, 7 ali več) (število, integer)

4. `pomankljivosti` - podatki o pomankljivostih stanovanj za vsako občino
  - `občina` - imenska spremenljivka: ime občine (neurejen faktor, character)
  - `število vseh stanovanj` - meritev: število vseh stanovanj (število, integer)
  - `število stanovanj brez centralnega ogrevanja` - meritev: število stanovanj brez centralnega ogrevanja (število, integer) 
  - `število stanovanj brez vode` - meritev: število stanovanj brez vode (število, integer)
  - `število stanovanj brez elektrike` - meritev: število stanovanj brez elektrike (število, integer)
  - `število stanovanj brez priklopa na javno kanalizacijo` - meritev: število stanovanj brez priklopa na javno kanalizacijo (število, integer)

Pretvorba razpredelnic v *tidy data*

1.`napeljave`
  - poimenovanje prvega stolpca
  - izbris vrstic (občin) s pomankljivimi podatki (v konkretnem primeru NA ali z)

2.`kazalniki`
  - poimenovanje stolpcev
  - izbris zadnjih dveh stolpcev, ki jih ne potrebujem

3.`število oseb in sob`
  -

4.`pomankljivosti`
  - poimenovanje stolpcev
  - izbris zadnjih 20 vrstic z nepomembnimi podatki


#vzorčni podatki
1. `druzine` - podatki o družinah za vsako občino
  - `obcina` - spremenljivka: ime občine (neurejen faktor),
  - `velikost.druzine` - spremenljivka: število otrok v družini (število: 1, 2, 3 ali 4, kjer zadnja vrednost pomeni 4 ali več),
  - `stevilo.druzin` - meritev: število družin z ustreznim številom otrok v ustrezni občini (število).

2. `obcine` - podatki o občinah
  - `obcina` - spremenljivka: ime občine (neurejen faktor),
  - `povrsina` - meritev: površina občine v km$^2$ (število),
  - `prebivalci` - meritev: prebivalstvo občine (število),
  - `gostota` - meritev: število prebivalcev na km$^2$ (število),
  - `naselja` - meritev: število naselij v občini (število),
  - `ustanovitev` - meritev: leto ustanovitve občine (število),
  - `pokrajina` - meritev: pokrajina, ki ji občina pripada (neurejen faktor),
  - `regija` - meritev: regija, ki ji občina pripada (neurejen faktor),
  - `odcepitev` - meritev: podatki o občinah, od katerih se je občina odcepila (besedilo).

**Opomba**: da bi razpredelnica `obcine` res bila v obliki *tidy data*, bi morali odstraniti stolpec `gostota` (saj je izpeljan iz stolpcev `povrsina` in `prebivalci`), podatke o pokrajinah pa bi morali premakniti v drugo razpredelnico, saj nekatere občine pripadajo dvema pokrajinama. Podobno bi morali narediti tudi s stolpcem `odcepitev`.

Spodnji graf prikazuje porazdelitev števila naselij v občinah.

```{r histogram, echo=FALSE, message=FALSE, fig.align='center', fig.cap='Histogram števila naselij v občinah'}
ggplot(obcine, aes(x=naselja)) + geom_histogram() +
  ggtitle("Pogostost števila naselij") + xlab("Število naselij") + ylab("Število občin")
```

***

# Analiza in vizualizacija podatkov

library(ggplot2)
library(dplyr)

#pomankljivosti
a <- vektor vsot po stolpcih
apply(pomankljivosti[-1], 2, sum)



#črtni diagram za napeljave 
vodovod <- napeljave[,c(1,2,9,16,23,30,37,44)]
kanalizacija <- napeljave[,c(1,3,10,17,24,31,38,45)]
električni_tok <- napeljave[,c(1,4,11,18,25,32,39,46)]
centralno_ogrevanje <- napeljave[,c(1,5,12,19,26,33,40,47)]
kopalnica <- napeljave[,c(1,6,13,20,27,34,41,48)]
stranišče <- napeljave[,c(1,7,14,21,28,35,42,49)]
kuhinja <- napeljave[,c(1,8,15,22,29,36,43,50)]




g_range <- range(0,vodovod)
plot(vodovod, type="o", col="blue",ylim=g_range,axes=FALSE, ann=FALSE)
axis(1, at=1:7, lab=c("2002","2003","2004","2005","2006","2007","2008"))


#vzorčni primer
```{r vizualizacija, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
source("vizualizacija/vizualizacija.r", encoding="UTF-8")
```

Spodnji zemljevid prikazuje povprečno velikost družine za vsako občino.

```{r zemljevid, echo=FALSE, fig.align='center', fig.cap='Zemljevid povprečnega števila otrok v družini'}
ggplot() + geom_polygon(data=left_join(zemljevid, povprecja, by=c("OB_UIME"="obcina")),
                        aes(x=long, y=lat, group=group, fill=povprecje)) +
  ggtitle("Povprečno število otrok v družini") + xlab("") + ylab("") +
  guides(fill=guide_colorbar(title="Povprečje"))
```

***

# Napredna analiza podatkov

```{r analiza, echo=FALSE, message=FALSE}
source("analiza/analiza.r", encoding="UTF-8")
```

Spodnji graf prikazuje povezavo med številom naselij in površino občine.

```{r graf, echo=FALSE, fig.align='center', fig.cap='Povezava med številom naselij in površino občine'}
ggplot(inner_join(obcine, data.frame(obcina=names(skupine),
                                     skupina=factor(skupine)), by="obcina")
, aes(x=povrsina, y=naselja, color=skupina, size=prebivalci/1000)) + geom_point() +
  ggtitle("Število naselij glede na površino občine") +
  xlab(expression("Površina (km"^2 * ")")) + ylab("Št. naselij") +
  guides(color=guide_legend(title="Skupina"),
         size=guide_legend(title="Prebivalci (* 1000)"))
```

***

```{r shiny, echo=FALSE}
shinyAppDir("shiny", options=list(width="100%", height=600))
```
